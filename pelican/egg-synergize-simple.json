{
    "_comment": "Synergize Platform - Frontend Only",
    "meta": {
        "version": "PTDL_v2",
        "update_url": null
    },
    "exported_at": "2024-12-07T00:00:00+00:00",
    "name": "Synergize Frontend (Next.js)",
    "author": "synergize@example.com",
    "description": "Synergize CS2 Community Platform - Next.js frontend. Features server browser, leaderboards, shop, and admin panel.",
    "features": null,
    "docker_images": {
        "Node 20": "ghcr.io/parkervcp/yolks:nodejs_20",
        "Node 18": "ghcr.io/parkervcp/yolks:nodejs_18"
    },
    "file_denylist": [],
    "startup": "cd /home/container/frontend && if [ -f .next/BUILD_ID ]; then npm run start -- -p ${PORT}; else npm install && npm run build && npm run start -- -p ${PORT}; fi",
    "config": {
        "files": "{}",
        "startup": "{\"done\": \"Ready in|ready started server on|Listening on\"}",
        "logs": "{}",
        "stop": "^C"
    },
    "scripts": {
        "installation": {
            "script": "#!/bin/bash\nset -e\n\necho \"========================================\"\necho \"  SYNERGIZE PLATFORM - INSTALLATION\"\necho \"========================================\"\necho \"\"\necho \"[INFO] Date: $(date)\"\necho \"[INFO] Installing to: /mnt/server\"\necho \"\"\n\n# Install dependencies\necho \"[STEP 1/5] Installing system dependencies...\"\napt update -qq\napt install -y git curl jq > /dev/null 2>&1\necho \"[OK] Dependencies installed\"\necho \"\"\n\n# Setup directory\necho \"[STEP 2/5] Setting up directory...\"\nmkdir -p /mnt/server\ncd /mnt/server\n\n# Clean if needed\nif [ \"$(ls -A /mnt/server 2>/dev/null)\" ]; then\n    echo \"[INFO] Directory not empty, cleaning...\"\n    rm -rf /mnt/server/* /mnt/server/.[!.]* 2>/dev/null || true\nfi\necho \"\"\n\n# Clone repository\necho \"[STEP 3/5] Downloading source code...\"\nif [ -z \"${GIT_REPO}\" ] || [ \"${GIT_REPO}\" = \"null\" ]; then\n    echo \"[ERROR] GIT_REPO is required!\"\n    echo \"[INFO] Set GIT_REPO to your GitHub repository URL\"\n    exit 1\nfi\n\necho \"[INFO] Repository: ${GIT_REPO}\"\necho \"[INFO] Branch: ${GIT_BRANCH:-master}\"\n\nif [ ! -z \"${GIT_TOKEN}\" ] && [ \"${GIT_TOKEN}\" != \"null\" ]; then\n    echo \"[INFO] Using authentication token\"\n    git clone --depth 1 --branch ${GIT_BRANCH:-master} https://${GIT_TOKEN}@${GIT_REPO#https://} /mnt/server\nelse\n    git clone --depth 1 --branch ${GIT_BRANCH:-master} ${GIT_REPO} /mnt/server\nfi\n\nif [ $? -ne 0 ]; then\n    echo \"[ERROR] Git clone failed!\"\n    exit 1\nfi\necho \"[OK] Repository cloned\"\necho \"\"\n\n# Install npm dependencies\necho \"[STEP 4/5] Installing npm dependencies...\"\nif [ -f \"/mnt/server/frontend/package.json\" ]; then\n    cd /mnt/server/frontend\n    echo \"[INFO] Found frontend/package.json\"\n    npm install --legacy-peer-deps 2>&1 | tail -5\n    echo \"[OK] Dependencies installed\"\nelse\n    echo \"[ERROR] frontend/package.json not found!\"\n    ls -la /mnt/server\n    exit 1\nfi\necho \"\"\n\n# Build Next.js\necho \"[STEP 5/5] Building Next.js for production...\"\ncd /mnt/server/frontend\necho \"[INFO] This may take a few minutes...\"\nnpm run build 2>&1 | tail -20\n\nif [ -d \".next\" ]; then\n    echo \"[OK] Build successful!\"\n    echo \"[INFO] Build size: $(du -sh .next | cut -f1)\"\nelse\n    echo \"[WARN] Build may have failed - .next not found\"\n    echo \"[INFO] Will attempt build on startup\"\nfi\necho \"\"\n\n# Summary\necho \"========================================\"\necho \"  INSTALLATION COMPLETE\"\necho \"========================================\"\necho \"\"\necho \"Contents of /mnt/server:\"\nls -la /mnt/server\necho \"\"\necho \"Frontend folder:\"\nls -la /mnt/server/frontend | head -15\necho \"\"\necho \"[DONE] You can now START the server!\"\necho \"\"\n",
            "container": "ghcr.io/parkervcp/installers:debian",
            "entrypoint": "bash"
        }
    },
    "variables": [
        {
            "name": "Server Port",
            "description": "Port the web server listens on. Must match your Pelican allocation.",
            "env_variable": "PORT",
            "default_value": "3000",
            "user_viewable": true,
            "user_editable": true,
            "rules": "required|integer|between:1,65535",
            "field_type": "text"
        },
        {
            "name": "Git Repository",
            "description": "Git repository URL (e.g., https://github.com/user/synergize.git)",
            "env_variable": "GIT_REPO",
            "default_value": "",
            "user_viewable": true,
            "user_editable": true,
            "rules": "required|string",
            "field_type": "text"
        },
        {
            "name": "Git Branch",
            "description": "Git branch to clone",
            "env_variable": "GIT_BRANCH",
            "default_value": "master",
            "user_viewable": true,
            "user_editable": true,
            "rules": "nullable|string",
            "field_type": "text"
        },
        {
            "name": "Git Access Token",
            "description": "Personal access token for private repos (leave empty for public)",
            "env_variable": "GIT_TOKEN",
            "default_value": "",
            "user_viewable": true,
            "user_editable": false,
            "rules": "nullable|string",
            "field_type": "text"
        },
        {
            "name": "API URL",
            "description": "Backend API URL (for future use with Laravel backend)",
            "env_variable": "NEXT_PUBLIC_API_URL",
            "default_value": "http://localhost:8000",
            "user_viewable": true,
            "user_editable": true,
            "rules": "nullable|string",
            "field_type": "text"
        }
    ]
}
