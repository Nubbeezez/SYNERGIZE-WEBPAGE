{
    "_comment": "Synergize Platform - Simplified Egg (Fixed paths)",
    "meta": {
        "version": "PTDL_v2",
        "update_url": null
    },
    "exported_at": "2024-12-07T00:00:00+00:00",
    "name": "Synergize Platform (Simple)",
    "author": "synergize@example.com",
    "description": "Simplified Synergize egg - Node.js frontend only. Use this for testing.",
    "features": null,
    "docker_images": {
        "Node 20": "ghcr.io/parkervcp/yolks:nodejs_20",
        "Node 18": "ghcr.io/parkervcp/yolks:nodejs_18"
    },
    "file_denylist": [],
    "startup": "if [ -d frontend ]; then cd frontend && npm install && npm run dev; elif [ -f package.json ]; then npm install && npm run dev; elif [ -f test.js ]; then node test.js; else echo 'No files found - please reinstall'; fi",
    "config": {
        "files": "{}",
        "startup": "{\"done\": \"ready started server on|Synergize test running\"}",
        "logs": "{}",
        "stop": "^C"
    },
    "scripts": {
        "installation": {
            "script": "#!/bin/bash\necho \"========================================\"\necho \"  SYNERGIZE - SIMPLE INSTALL\"\necho \"========================================\"\necho \"\"\necho \"[INFO] Starting installation...\"\necho \"[INFO] Date: $(date)\"\necho \"\"\n\n# Install dependencies\necho \"[STEP 1/4] Installing system dependencies...\"\napt update\napt install -y git curl jq\necho \"[OK] Dependencies installed\"\necho \"\"\n\n# IMPORTANT: Use /mnt/server for installation (Pelican maps this to /home/container)\necho \"[STEP 2/4] Setting up directory...\"\nmkdir -p /mnt/server\ncd /mnt/server\necho \"[INFO] Working directory: $(pwd)\"\necho \"[INFO] Contents before:\"\nls -la\necho \"\"\n\n# Download code or create test file\necho \"[STEP 3/4] Downloading source code...\"\nif [ -z \"${GIT_REPO}\" ] || [ \"${GIT_REPO}\" = \"null\" ] || [ \"${GIT_REPO}\" = \"\" ]; then\n    echo \"[INFO] No GIT_REPO set - creating test file\"\n    cat > /mnt/server/test.js << 'TESTFILE'\nconsole.log(\"========================================\");\nconsole.log(\"  Synergize test running!\");\nconsole.log(\"========================================\");\nconsole.log(\"\");\nconsole.log(\"The egg is working correctly.\");\nconsole.log(\"Now you can set GIT_REPO to your repository\");\nconsole.log(\"and reinstall to fetch your actual code.\");\nconsole.log(\"\");\nconsole.log(\"Keeping server alive...\");\nsetInterval(() => {\n    console.log(\"[\" + new Date().toISOString() + \"] Still running...\");\n}, 30000);\nTESTFILE\n    echo \"[OK] Created test.js\"\nelse\n    echo \"[INFO] Cloning: ${GIT_REPO}\"\n    echo \"[INFO] Branch: ${GIT_BRANCH:-main}\"\n    \n    # Clean directory first if needed\n    if [ \"$(ls -A /mnt/server 2>/dev/null)\" ]; then\n        echo \"[INFO] Directory not empty, cleaning...\"\n        rm -rf /mnt/server/* /mnt/server/.[!.]* 2>/dev/null || true\n    fi\n    \n    # Clone the repo\n    if [ ! -z \"${GIT_TOKEN}\" ] && [ \"${GIT_TOKEN}\" != \"null\" ] && [ \"${GIT_TOKEN}\" != \"\" ]; then\n        echo \"[INFO] Using authentication token\"\n        git clone --branch ${GIT_BRANCH:-main} https://${GIT_TOKEN}@${GIT_REPO#https://} /mnt/server\n    else\n        echo \"[INFO] Cloning public repo\"\n        git clone --branch ${GIT_BRANCH:-main} ${GIT_REPO} /mnt/server\n    fi\n    \n    if [ $? -eq 0 ]; then\n        echo \"[OK] Repository cloned successfully\"\n    else\n        echo \"[ERROR] Git clone failed!\"\n        exit 1\n    fi\nfi\necho \"\"\n\n# Show what we got\necho \"[STEP 4/4] Installation summary\"\necho \"========================================\"\necho \"Contents of /mnt/server:\"\nls -la /mnt/server\necho \"========================================\"\necho \"\"\necho \"[DONE] Installation complete!\"\necho \"[INFO] You can now START the server\"\necho \"\"\n",
            "container": "ghcr.io/parkervcp/installers:debian",
            "entrypoint": "bash"
        }
    },
    "variables": [
        {
            "name": "Server Port",
            "description": "Port the web server listens on. Must match your Pelican allocation.",
            "env_variable": "PORT",
            "default_value": "3000",
            "user_viewable": true,
            "user_editable": true,
            "rules": "required|integer|between:1,65535",
            "field_type": "text"
        },
        {
            "name": "Git Repository",
            "description": "Git repository URL (e.g., https://github.com/user/synergize.git). Leave empty for test mode.",
            "env_variable": "GIT_REPO",
            "default_value": "",
            "user_viewable": true,
            "user_editable": true,
            "rules": "nullable|string",
            "field_type": "text"
        },
        {
            "name": "Git Branch",
            "description": "Git branch to clone",
            "env_variable": "GIT_BRANCH",
            "default_value": "main",
            "user_viewable": true,
            "user_editable": true,
            "rules": "nullable|string",
            "field_type": "text"
        },
        {
            "name": "Git Access Token",
            "description": "Personal access token for private repos (leave empty for public)",
            "env_variable": "GIT_TOKEN",
            "default_value": "",
            "user_viewable": true,
            "user_editable": true,
            "rules": "nullable|string",
            "field_type": "text"
        }
    ]
}
